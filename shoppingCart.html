<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Shopping Cart System</title>
    <style>
        /* Simple CSS for layout and readability */
        body { font-family: sans-serif; background-color: #f4f4f9; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; }
        
        /* Input and Button Styling */
        input[type="text"], input[type="number"] { padding: 8px; margin-right: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background 0.2s; }
        button:hover { background-color: #0056b3; }
        .btn-danger { background-color: #dc3545; }
        .btn-danger:hover { background-color: #c82333; }
        
        /* Layout Sections */
        .section { margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .status-msg { padding: 10px; margin-bottom: 15px; border-radius: 4px; display: none; }
        .status-success { background-color: #d4edda; color: #155724; display: block; }
        .status-error { background-color: #f8d7da; color: #721c24; display: block; }

        /* Cart Table Styling */
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; }
        .qty-input { width: 60px; }

        /* Totals Section Styling */
        .totals-area { background-color: #f9f9f9; padding: 20px; border-radius: 8px; text-align: right; }
        .totals-area p { margin: 5px 0; }
        .final-total { font-size: 1.4em; font-weight: bold; color: #28a745; }
    </style>
</head>
<body>

<div class="container">
    <h1>Shopping Cart System</h1>

    <div id="status-box" class="status-msg"></div>

    <div class="section">
        <h2>Add Product</h2>
        <input type="text" id="in-prod-name" placeholder="Product Name (e.g., Laptop)">
        <input type="number" id="in-prod-price" placeholder="Price" min="0.01" step="0.01">
        <input type="number" id="in-prod-qty" placeholder="Quantity" min="1" value="1">
        <button onclick="ui_addItem()">Add to Cart</button>
    </div>

    <div class="section">
        <h2>Your Cart items</h2>
        <table id="cart-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="cart-body">
                </tbody>
        </table>
        <p id="empty-cart-msg">Your cart is empty.</p>
    </div>

    <div class="section" style="display: flex; align-items: center;">
        <input type="text" id="in-discount" placeholder="Coupon Code (e.g., SAVE10)">
        <button onclick="ui_applyDiscount()">Apply Coupon</button>
    </div>

    <div class="totals-area">
        <p>Subtotal: $<span id="lbl-subtotal">0.00</span></p>
        <p>Discount (<span id="lbl-discount-code">None</span>): -$<span id="lbl-discount-amt">0.00</span></p>
        <p>Tax (10%): +$<span id="lbl-tax">0.00</span></p>
        <p class="final-total">Total Payable: $<span id="lbl-total">0.00</span></p>
    </div>
</div>
<script>
class ShoppingCart {
  constructor() {
    this.items = {}; // Used Object for efficient lookups 
    this.taxRate = 0.10;
    this.discountRate = 0.0;
    this.activeCoupon = null;
  }
  addItem(product, price, quantity) {
    // Validation
    if (!product || typeof product !== 'string') return { success: false, msg: "Invalid product name." };
    if (isNaN(price) || price <= 0) return { success: false, msg: "Price must be greater than 0." };
    if (isNaN(quantity) || quantity <= 0 || !Number.isInteger(quantity)) return { success: false, msg: "Quantity must be a positive integer." };

    if (this.items[product]) {
      // Update existing item quantity, update price to latest
      this.items[product].quantity += quantity;
      this.items[product].price = price;
    } else {
      // Create new item entry
      this.items[product] = { price: parseFloat(price), quantity: parseInt(quantity) };
    }
    return { success: true, msg: `Added ${quantity} ${product}(s)` };
  }

  removeItem(product) {
    if (this.items[product]) {
      delete this.items[product];
      return { success: true, msg: `Removed ${product}` };
    }
    return { success: false, msg: "Item not found" };
  }

  updateQuantity(product, quantity) {
    quantity = parseInt(quantity);
    if (!this.items[product]) return { success: false, msg: "Item not found." };
    if (isNaN(quantity) || quantity <= 0) return { success: false, msg: "Quantity must be positive." };
    
    this.items[product].quantity = quantity;
    return { success: true, msg: "Quantity updated" };
  }

  getSubtotal() {
    let subtotal = 0;
    for (let product in this.items) {
      subtotal += this.items[product].price * this.items[product].quantity;
    }
    return subtotal;
  }

  applyDiscount(code) {
    const upperCode = code ? code.trim().toUpperCase() : "";

    if(upperCode === "") {
         this.discountRate = 0.0;
         this.activeCoupon = null;
         return { success: true, msg: "Coupon removed." };
    } else if (upperCode === "SAVE10") {
      this.discountRate = 0.10;
      this.activeCoupon = "SAVE10";
      return { success: true, msg: "10% discount applied!" };
    } else if (upperCode === "SAVE20") {
      this.discountRate = 0.20;
      this.activeCoupon = "SAVE20";
      return { success: true, msg: "20% discount applied!" };
    } else {
      return { success: false, msg: "Invalid coupon code." };
    }
  }
  // Tax applied after discount
  getTotal() {
    const subtotal = this.getSubtotal();
    const discountAmount = subtotal * this.discountRate;
    const taxableAmount = subtotal - discountAmount;
    const taxAmount = taxableAmount * this.taxRate; 
    const total = taxableAmount + taxAmount;
    return {
      subtotal: subtotal.toFixed(2),
      discountApplied: this.activeCoupon || "None",
      discountAmount: discountAmount.toFixed(2),
      tax: taxAmount.toFixed(2),
      finalTotal: total.toFixed(2)
    };
  }
  // check if cart is empty f
  isEmpty() {
      return Object.keys(this.items).length === 0;
  }
}
// 1. Instantiate the system
const myCart = new ShoppingCart();

// 2. Helper function to show status messages
function showStatus(message, isError = false) {
    const statusBox = document.getElementById('status-box');
    statusBox.textContent = message;
    statusBox.className = isError ? 'status-msg status-error' : 'status-msg status-success';
    setTimeout(() => { statusBox.className = 'status-msg'; }, 3000);
}
// 3. UI Event Handlers
function ui_addItem() {
    const nameInput = document.getElementById('in-prod-name');
    const priceInput = document.getElementById('in-prod-price');
    const qtyInput = document.getElementById('in-prod-qty');
    // Call backend logic
    const result = myCart.addItem(nameInput.value, priceInput.value, Number(qtyInput.value));

    if(result.success) {
        // Clear inputs on success
        nameInput.value = ''; priceInput.value = ''; qtyInput.value = '1';
        showStatus(result.msg);
        ui_renderCart(); 
    } else {
        showStatus(result.msg, true);
    }
}
function ui_removeItem(productName) {
    const result = myCart.removeItem(productName);
    showStatus(result.msg, !result.success);
    ui_renderCart();
}
function ui_updateQty(productName, newQty) {
    // Prevent updating to zero or negative via direct input
    if(newQty < 1) {
        ui_renderCart(); // Reset the input field by re-rendering
        return; 
    }
    const result = myCart.updateQuantity(productName, newQty);
    if(!result.success) showStatus(result.msg, true);
    ui_renderCart();
}

function ui_applyDiscount() {
    const codeInput = document.getElementById('in-discount');
    const result = myCart.applyDiscount(codeInput.value);
    
    if(result.success) {
        showStatus(result.msg);
        ui_renderCart();
    } else {
        showStatus(result.msg, true);
    }
}

// 4. The Main Render Function
function ui_renderCart() {
    const tbody = document.getElementById('cart-body');
    const emptyMsg = document.getElementById('empty-cart-msg');
    
    tbody.innerHTML = ''; // Clear current list rows

    if (myCart.isEmpty()) {
        emptyMsg.style.display = 'block';
    } else {
        emptyMsg.style.display = 'none';
        
        // Iterate through the cart items object
        for (let product in myCart.items) {
            const item = myCart.items[product];
            const itemTotal = (item.price * item.quantity).toFixed(2);

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${product}</td>
                <td>$${item.price.toFixed(2)}</td>
                <td>
                    <input type="number" class="qty-input" value="${item.quantity}" min="1" 
                           onchange="ui_updateQty('${product}', this.value)">
                </td>
                <td>$${itemTotal}</td>
                <td>
                    <button class="btn-danger" onclick="ui_removeItem('${product}')">Remove</button>
                </td>
            `;
            tbody.appendChild(row);
        }
    }

    // Update Totals Block
    const totals = myCart.getTotal();
    document.getElementById('lbl-subtotal').textContent = totals.subtotal;
    document.getElementById('lbl-discount-code').textContent = totals.discountApplied;
    document.getElementById('lbl-discount-amt').textContent = totals.discountAmount;
    document.getElementById('lbl-tax').textContent = totals.tax;
    document.getElementById('lbl-total').textContent = totals.finalTotal;
}
ui_renderCart();

</script>
</body>
</html>